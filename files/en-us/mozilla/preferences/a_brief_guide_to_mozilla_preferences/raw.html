<div class="indent">
<p>This article is intended for Mozilla power users and system administrators. It provides a general overview of Mozilla preferences, including where preferences are stored, a file-by-file analysis of preference loading sequence, and information on editing preferences.</p>
</div>

<h2 id="What_is_a_preference"><span id="def">What is a preference?</span></h2>

<div class="indent">
<p>A preference is any value or defined behavior that can be set (presumably, one setting is <q>preferable</q> to another). Preference changes via user interface usually take effect immediately. The values are saved to the user profile (in <code>prefs.js</code>), for both Firefox and Thunderbird.</p>

<p>A preference is read from a file, and can call up to four methods: <code>pref()</code>, <code>user_pref(), sticky_pref()</code> and <code>lockPref()</code>. All preferences files may call <code>pref()</code>, <code>user_pref()</code> and <code>sticky_pref()</code>, while the <span class="term">config file</span> in addition may call <code>lockPref()</code>.</p>
</div>

<h2 id="Preferences_files"><span id="file">Preferences files</span></h2>

<div class="indent">
<p><span id="files-skipline">To protect privacy by preventing</span> inadvertent loading of a preferences file in the browser, the first line of the file is made un-parseable and skipped on loading. The only exception to this is <code>user.js</code> .</p>

<p>On application launch, several preferences files are loaded. They are:</p>

<dl>
 <dt class="term"><span id="files-def">Default <abbr title="preferences">preference</abbr> files</span></dt>
 <dd>
 <p>Firefox ships default preferences in several files, all in the application directory:</p>

 <ul>
  <li>greprefs.js - preferences shared by all applications using the Mozilla platform</li>
  <li>services/common/services-common.js - preferences for some shared services code, this should arguably be included in some other file</li>
  <li>defaults/pref/services-sync.js - default preferences for Firefox sync, also oddly misplaced</li>
  <li>browser/app/profile/channel-prefs.js - a file indicating the user's update channel. This is kept separate from other preferences because it can affect how updates are applied.</li>
  <li>browser/app/profile/firefox.js - defaults specific to Firefox</li>
  <li>browser/app/profile/firefox-branding.js - defaults specific to the specific kind of Firefox being installed (Nightly, Aurora, Beta, Release)</li>
  <li>browser/defaults/preferences/firefox-l10n.js - defaults specific to the installed language of Firefox. None of the other preference files contain locale-specific preferences.</li>
 </ul>
 </dd>
 <dt class="term"><span id="files-conf"><abbr title="configuration">Config.</abbr></span> file</dt>
 <dd>
 <p>A configuration file, usually with <code>.cfg</code> extension, may be called from a <span class="term">default pref file</span> via the <code>general.config.filename</code> preference. This file allows preference locking via the <code>lock_pref()</code> function. Details on the <span class="term">config file</span> is beyond the scope of this document.</p>
 </dd>
 <dt class="term"><span id="files-user">User pref. files</span></dt>
 <dd>
 <p>In the profile directory are two <span class="term">user pref files</span>: <code>prefs.js</code> and <code>user.js</code>.  <code>prefs.js</code> is automatically generated by the application and should not be edited manually, whereas <code>user.js</code> is an optional file the user can create to override preferences initialized by other preferences files.</p>
 </dd>
</dl>
</div>

<h2 id="Preferences_Loading_and_Resolution"><span id="loading">Preferences Loading and Resolution</span></h2>

<div class="indent">
<p>On application launch, the application loads preferences in the following order:</p>

<ol>
 <li>
  <p>Load all <span class="term">default pref files</span>.</p>
 </li>
 <li>
  <p>Optionally load the <span class="term">config file</span>.</p>
 </li>
 <li>
  <p>Load <span class="term">user pref files</span>, first <code>prefs.js</code>, then <code>user.js</code> .</p>
 </li>
</ol>

<p>Preference conflicts are resolved in favor of the last entry; for example, <code>user.js</code> takes precedence over <code>prefs.js</code> .</p>

<p>If the application encounters any error during loading of a <span class="term">default pref file</span>, the application will issue a warning that a configuration file has failed to load and then quit. This allows system administrators to know quickly if there is a configuration error in the installation. If the application encounters an error when loading <span class="term">user pref files</span>, the application will issue a warning but will continue running.</p>
</div>

<h2 id="Preferences_Saving"><span id="saving">Preferences Saving</span></h2>

<div class="indent">
<p>Usually when the user specifically commits a preference change via user interface such as the Preferences dialog, the application saves the change by overwriting <code>prefs.js</code> . On application exit, all user-set preferences are saved to <code>prefs.js</code> . This also means that preferences initially set by <code>user.js</code> will also be saved to <code>prefs.js</code>.</p>

<p class="note"><strong>Do NOT</strong> edit <code>prefs.js</code> directly.</p>

<p>Note the application never changes <code>user.js</code>, so on launch <code>user.js</code> overrides conflicting preferences from the previous application session.</p>

<p>When <code>prefs.js</code> is written, it only saves user preferences which are different from the default. The exception to this is a preference read using <code>sticky_pref()</code> - these preference will be written whenever the preference has a user value even when it is the same as the default.</p>
</div>

<h2 id="Modifying_preferences"><span id="modifying">Modifying preferences</span></h2>

<div class="indent">
<p>Advanced users can set named preferences via the advanced preferences editor, by typing <code>about:config</code> in the Location Bar. This UI is not recommended for most users. Programmatic changes to preferences can be made using the <a href="http://dxr.mozilla.org/mozilla-central/source/toolkit/modules/Preferences.jsm" title="http://dxr.mozilla.org/mozilla-central/source/toolkit/modules/Preferences.jsm">Preferences.jsm</a> module from JS code, or the mozilla::Preferences static class methods from C++ code.</p>

<h3 id="Changing_defaults">Changing defaults</h3>

<p>A systems administrator can modify the default preferences in two ways:</p>

<ol>
 <li>The administrator may add an <code>all-<em>companyname</em>.js</code> preference file (<code>install_directory/browser/defaults/preferences/all-<em>companyname</em>.js</code>).  This will be parsed last during the preference loading process.</li>
 <li>
  <p>The administrator may alternatively put a <code>user.js</code> file in <code><em>app_dir</em>/defaults/profile/</code> ; this will put a copy of the <code>user.js</code> in all new profiles. This method has the advantage of resetting preferences back to administrator defaults at every start-up. Note that, because a user typically has access privilege to his or her profile directory, he or she can change the default values if he or she knows how. Another disadvantage is that existing profiles will not be affected. <em>This method is considered user-hostile. Any use of this technique by software such as Firefox extension to override normal user preference will result in being added to the Firefox blocklist or the preferences being forcibly removed.</em></p>
 </li>
</ol>

<div class="note">
<p>Note: because of abuse of user.js preferences, support for user.js may be removed in a future version of Firefox. See <!-- {{bug("1543752")}} -->.</p>
</div>
</div>

<h2 id="Sticky_Preferences">Sticky Preferences</h2>

<p>Sticky preferences were introduced in Firefox 40 via <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1098343">bug 1098343</a>.</p>

<p>Sticky preferences are created when they are defined using <code>sticky_pref()</code>. These preferences act as default preferences but whenever a value is created for the preference, that value is always written even when it matches the default. Sticky preferences are generally used for preferences that have a different default value in different channels with the intent being that once the user sets the preference in one channel, the preference will remain with that value when using a different channel with different defaults. For example, let's assume that Nightly has a preference "some.preference" which defaults to <code>true</code> while DeveloperEdition defaults the same preference to <code>false</code> and the user desires the preference to have the value <code>true</code> in both channels. If the preference is not a sticky preference and the user runs DeveloperEdition and flips the pref to <code>true</code> it will be saved as it is not the default. When the user then runs Nightly, the preference now has the same value as the default, so is <em>not</em> written by Nightly. When the user then runs DeveloperEdition again, the preference value will be <code>false</code> as no user preference was written by Nightly. If the preference is defined as a sticky preference, the value <code>true</code> <em>will</em> be written by Nightly even though it matches the current default, so when DeveloperEdition is run the preference keeps the desired value of <code>true</code>.</p>